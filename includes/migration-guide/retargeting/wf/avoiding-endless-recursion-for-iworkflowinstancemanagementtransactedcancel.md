---
ms.openlocfilehash: ab9431780422dfece5dcf8007d13e6d584f5118f
ms.sourcegitcommit: 721c3e4bdbb1ea0bb420818ec944c538fe5c513a
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 12/01/2020
ms.locfileid: "96477987"
---
### <a name="avoiding-endless-recursion-for-iworkflowinstancemanagementtransactedcancel-and-iworkflowinstancemanagementtransactedterminate"></a><span data-ttu-id="7825b-101">Evitar la recursión sin fin para IWorkflowInstanceManagement.TransactedCancel e IWorkflowInstanceManagement.TransactedTerminate</span><span class="sxs-lookup"><span data-stu-id="7825b-101">Avoiding endless recursion for IWorkflowInstanceManagement.TransactedCancel and IWorkflowInstanceManagement.TransactedTerminate</span></span>

#### <a name="details"></a><span data-ttu-id="7825b-102">Detalles</span><span class="sxs-lookup"><span data-stu-id="7825b-102">Details</span></span>

<span data-ttu-id="7825b-103">En algunas circunstancias, cuando se usan las API <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> o <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> para cancelar o finalizar una instancia del servicio de flujo de trabajo, se puede producir un desbordamiento de pila en la instancia de flujo de trabajo debido a la recursión sin fin cuando el tiempo de ejecución de `Workflow` intenta conservar la instancia del servicio como parte del procesamiento de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="7825b-103">Under some circumstances when using <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> APIs to cancel or terminate a workflow service instance, the workflow instance may encounter a stack overflow due to endless recursion when the `Workflow` runtime attempts to persist the service instance as part of processing the request.</span></span> <span data-ttu-id="7825b-104">El problema se produce si la instancia del flujo de trabajo está en un estado en el que espera que finalice otra solicitud de WCF pendiente a otro servicio.</span><span class="sxs-lookup"><span data-stu-id="7825b-104">The problem occurs if the workflow instance is in a state where it is waiting for some other outstanding WCF request to another service to complete.</span></span> <span data-ttu-id="7825b-105">Las operaciones `TransactedCancel` y `TransactedTerminate` crean elementos de trabajo que se ponen en cola para la instancia del servicio de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="7825b-105">The `TransactedCancel` and `TransactedTerminate` operations create work items that are queued for the workflow service instance.</span></span> <span data-ttu-id="7825b-106">Estos elementos de trabajo no se ejecutan como parte del procesamiento de la solicitud de `TransactedCancel/TransactedTerminate`.</span><span class="sxs-lookup"><span data-stu-id="7825b-106">These work items are not executed as part of the processing of the `TransactedCancel/TransactedTerminate` request.</span></span> <span data-ttu-id="7825b-107">Como la instancia del servicio de flujo de trabajo está ocupada en espera a que finalice la otra solicitud de WCF pendiente, el elemento de trabajo que se crea permanece en cola.</span><span class="sxs-lookup"><span data-stu-id="7825b-107">Because the workflow service instance is busy waiting for the other outstanding WCF request to complete, the work item created remains queued.</span></span> <span data-ttu-id="7825b-108">La operación `TransactedCancel/TransactedTerminate` se completa y el control se devuelve al cliente.</span><span class="sxs-lookup"><span data-stu-id="7825b-108">The `TransactedCancel/TransactedTerminate` operation completes and control is returned back to the client.</span></span> <span data-ttu-id="7825b-109">Cuando la transacción asociada con la operación `TransactedCancel/TransactedTerminate` intenta confirmar, debe conservar el estado de la instancia del servicio de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="7825b-109">When the transaction associated with the `TransactedCancel/TransactedTerminate` operation attempts to commit, it needs to persist the workflow service instance state.</span></span> <span data-ttu-id="7825b-110">Pero como existe una solicitud de `WCF` pendiente para la instancia, el tiempo de ejecución del flujo de trabajo no puede conservar la instancia del servicio de flujo de trabajo y un bucle de recursión sin fin genera el desbordamiento de pila. Dado que `TransactedCancel` y `TransactedTerminate` solo crean un elemento de trabajo en memoria, el hecho de que exista una transacción no tiene ningún efecto.</span><span class="sxs-lookup"><span data-stu-id="7825b-110">But because there is an outstanding `WCF` request for the instance, the Workflow runtime cannot persist the workflow service instance, and an endless recursion loop leads to the stack overflow.Because `TransactedCancel` and `TransactedTerminate` only create a work item in memory, the fact that a transaction exists doesn't have any effect.</span></span> <span data-ttu-id="7825b-111">La reversión de la transacción no descarta el elemento de trabajo. Para solucionar este problema, a partir de .NET Framework 4.7.2, se ha introducido un `AppSetting` que se puede agregar a la sección `web.config/app.config` del servicio de flujo de trabajo que le indica que ignore las transacciones para `TransactedCancel` y `TransactedTerminate`.</span><span class="sxs-lookup"><span data-stu-id="7825b-111">A rollback of the transaction does not discard the work item.To address this issue, starting in .NET Framework 4.7.2, we have introduced an `AppSetting` that can be added to the `web.config/app.config` of the workflow service that tells it to ignore transactions for `TransactedCancel` and `TransactedTerminate`.</span></span> <span data-ttu-id="7825b-112">Esto permite que la transacción se confirme sin esperar a que se conserve la instancia del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="7825b-112">This allows the transaction to commit without waiting for the workflow instance to persist.</span></span> <span data-ttu-id="7825b-113">La opción AppSetting para esta característica se denomina `microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate`.</span><span class="sxs-lookup"><span data-stu-id="7825b-113">The AppSetting for this feature is named `microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate`.</span></span> <span data-ttu-id="7825b-114">Un valor de `true` indica que la transacción se debe ignorar, lo que evita el desbordamiento de pila.</span><span class="sxs-lookup"><span data-stu-id="7825b-114">A value of `true` indicates that the transaction should be ignored, thus avoiding the stack overflow.</span></span> <span data-ttu-id="7825b-115">El valor predeterminado de este AppSetting es `false`, por lo que las instancias del servicio de flujo de trabajo existentes no se ven afectadas.</span><span class="sxs-lookup"><span data-stu-id="7825b-115">The default value of this AppSetting is `false`, so existing workflow service instances are not affected.</span></span>

#### <a name="suggestion"></a><span data-ttu-id="7825b-116">Sugerencia</span><span class="sxs-lookup"><span data-stu-id="7825b-116">Suggestion</span></span>

<span data-ttu-id="7825b-117">Si se usa AppFabric u otro cliente de <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> y se produce un desbordamiento de pila en la instancia del servicio de flujo de trabajo al intentar cancelar o finalizar una instancia del flujo de trabajo, se puede agregar lo siguiente a la sección `<appSettings>` del archivo web.config/app.config del servicio de flujo de trabajo:</span><span class="sxs-lookup"><span data-stu-id="7825b-117">If you are using AppFabric or another <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> client and are encountering a stack overflow in the workflow service instance when trying to cancel or terminate a workflow instance, you can add the following to the `<appSettings>` section of the web.config/app.config file for the workflow service:</span></span>

<pre><code class="lang-xml">&lt;add key=&quot;microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate&quot; value=&quot;true&quot;/&gt;&#13;&#10;</code></pre>

<span data-ttu-id="7825b-118">Si el problema no se produce, no es necesario hacer esto.</span><span class="sxs-lookup"><span data-stu-id="7825b-118">If you are not encountering the problem, you do not need to do this.</span></span>

| <span data-ttu-id="7825b-119">NOMBRE</span><span class="sxs-lookup"><span data-stu-id="7825b-119">Name</span></span>    | <span data-ttu-id="7825b-120">Valor</span><span class="sxs-lookup"><span data-stu-id="7825b-120">Value</span></span>       |
|:--------|:------------|
| <span data-ttu-id="7825b-121">Ámbito</span><span class="sxs-lookup"><span data-stu-id="7825b-121">Scope</span></span>   | <span data-ttu-id="7825b-122">Borde</span><span class="sxs-lookup"><span data-stu-id="7825b-122">Edge</span></span>        |
| <span data-ttu-id="7825b-123">Versión</span><span class="sxs-lookup"><span data-stu-id="7825b-123">Version</span></span> | <span data-ttu-id="7825b-124">4.7.2</span><span class="sxs-lookup"><span data-stu-id="7825b-124">4.7.2</span></span>       |
| <span data-ttu-id="7825b-125">Tipo</span><span class="sxs-lookup"><span data-stu-id="7825b-125">Type</span></span>    | <span data-ttu-id="7825b-126">Redestinación</span><span class="sxs-lookup"><span data-stu-id="7825b-126">Retargeting</span></span> |
